# API設計

## 基本情報
- **ベースURL**: `/api/v1`
- **レスポンス形式**: JSON
- **認証方式**: JWT (JSON Web Token)
- **エラーレスポンス**:
  ```json
  {
    "status": "error",
    "code": 400,
    "message": "エラーメッセージ"
  }
  ```
- **成功レスポンス**:
  ```json
  {
    "status": "success",
    "data": { ... }
  }
  ```

## 認証API

### ユーザー登録
- **エンドポイント**: `POST /auth/register`
- **リクエスト**:
  ```json
  {
    "email": "user@example.com",
    "password": "password123",
    "name": "User Name"
  }
  ```
- **レスポンス**:
  ```json
  {
    "status": "success",
    "data": {
      "user": {
        "id": "user_id",
        "email": "user@example.com",
        "name": "User Name"
      },
      "token": "jwt_token"
    }
  }
  ```

### ログイン
- **エンドポイント**: `POST /auth/login`
- **リクエスト**:
  ```json
  {
    "email": "user@example.com",
    "password": "password123"
  }
  ```
- **レスポンス**:
  ```json
  {
    "status": "success",
    "data": {
      "user": {
        "id": "user_id",
        "email": "user@example.com",
        "name": "User Name"
      },
      "token": "jwt_token"
    }
  }
  ```

### パスワードリセット要求
- **エンドポイント**: `POST /auth/password-reset`
- **リクエスト**:
  ```json
  {
    "email": "user@example.com"
  }
  ```
- **レスポンス**:
  ```json
  {
    "status": "success",
    "message": "パスワードリセット用のメールを送信しました"
  }
  ```

## YouTube API連携

### チャンネル連携
- **エンドポイント**: `POST /youtube/connect`
- **リクエスト**:
  ```json
  {
    "authorization_code": "oauth_code"
  }
  ```
- **レスポンス**:
  ```json
  {
    "status": "success",
    "data": {
      "channel_id": "channel_id",
      "channel_title": "Channel Title",
      "thumbnail_url": "thumbnail_url"
    }
  }
  ```

### チャンネル情報取得
- **エンドポイント**: `GET /youtube/channels`
- **レスポンス**:
  ```json
  {
    "status": "success",
    "data": {
      "channels": [
        {
          "id": "channel_id",
          "title": "Channel Title",
          "thumbnail_url": "thumbnail_url",
          "subscriber_count": 1000,
          "video_count": 50,
          "view_count": 100000,
          "connected_at": "2023-01-01T00:00:00Z"
        }
      ]
    }
  }
  ```

### 動画一覧取得
- **エンドポイント**: `GET /youtube/videos?channel_id={channel_id}&page={page}&limit={limit}`
- **レスポンス**:
  ```json
  {
    "status": "success",
    "data": {
      "videos": [
        {
          "id": "video_id",
          "title": "Video Title",
          "thumbnail_url": "thumbnail_url",
          "published_at": "2023-01-01T00:00:00Z",
          "view_count": 1000,
          "like_count": 100,
          "comment_count": 50,
          "duration": "PT10M30S"
        }
      ],
      "pagination": {
        "total": 50,
        "page": 1,
        "limit": 10,
        "pages": 5
      }
    }
  }
  ```

### 動画詳細取得
- **エンドポイント**: `GET /youtube/videos/{video_id}`
- **レスポンス**:
  ```json
  {
    "status": "success",
    "data": {
      "id": "video_id",
      "title": "Video Title",
      "description": "Video Description",
      "thumbnail_url": "thumbnail_url",
      "published_at": "2023-01-01T00:00:00Z",
      "channel_id": "channel_id",
      "channel_title": "Channel Title",
      "view_count": 1000,
      "like_count": 100,
      "comment_count": 50,
      "favorite_count": 25,
      "duration": "PT10M30S",
      "tags": ["tag1", "tag2"],
      "category_id": "22"
    }
  }
  ```

## 分析API

### チャンネル分析
- **エンドポイント**: `GET /analytics/channel/{channel_id}?period={day|week|month|year}`
- **レスポンス**:
  ```json
  {
    "status": "success",
    "data": {
      "subscriber_growth": [
        { "date": "2023-01-01", "count": 950 },
        { "date": "2023-01-02", "count": 975 },
        { "date": "2023-01-03", "count": 1000 }
      ],
      "view_growth": [
        { "date": "2023-01-01", "count": 95000 },
        { "date": "2023-01-02", "count": 97500 },
        { "date": "2023-01-03", "count": 100000 }
      ],
      "engagement_rate": 5.2,
      "average_view_duration": 380,
      "top_videos": [
        { "id": "video_id1", "title": "Top Video 1", "view_count": 5000 },
        { "id": "video_id2", "title": "Top Video 2", "view_count": 4500 }
      ]
    }
  }
  ```

### 動画分析
- **エンドポイント**: `GET /analytics/video/{video_id}`
- **レスポンス**:
  ```json
  {
    "status": "success",
    "data": {
      "view_trend": [
        { "date": "2023-01-01", "count": 500 },
        { "date": "2023-01-02", "count": 750 },
        { "date": "2023-01-03", "count": 1000 }
      ],
      "engagement": {
        "like_ratio": 10.0,
        "comment_ratio": 5.0,
        "share_count": 25
      },
      "audience_retention": [
        { "position": 0, "retention_rate": 100 },
        { "position": 30, "retention_rate": 80 },
        { "position": 60, "retention_rate": 65 }
      ],
      "traffic_sources": [
        { "source": "YouTube search", "percentage": 45 },
        { "source": "External", "percentage": 30 },
        { "source": "Suggested videos", "percentage": 25 }
      ]
    }
  }
  ```

## レポートAPI

### レポート生成
- **エンドポイント**: `POST /reports/generate`
- **リクエスト**:
  ```json
  {
    "report_type": "channel_performance",
    "channel_id": "channel_id",
    "date_range": {
      "start_date": "2023-01-01",
      "end_date": "2023-01-31"
    },
    "format": "pdf"
  }
  ```
- **レスポンス**:
  ```json
  {
    "status": "success",
    "data": {
      "report_id": "report_id",
      "status": "generating",
      "estimated_completion_time": 30
    }
  }
  ```

### レポート状態確認
- **エンドポイント**: `GET /reports/{report_id}`
- **レスポンス**:
  ```json
  {
    "status": "success",
    "data": {
      "report_id": "report_id",
      "status": "completed",
      "created_at": "2023-01-01T00:00:00Z",
      "download_url": "https://example.com/reports/download/report_id"
    }
  }
  ```

## ユーザー管理API

### ユーザープロフィール取得
- **エンドポイント**: `GET /users/profile`
- **レスポンス**:
  ```json
  {
    "status": "success",
    "data": {
      "id": "user_id",
      "email": "user@example.com",
      "name": "User Name",
      "created_at": "2023-01-01T00:00:00Z",
      "subscription": {
        "plan": "premium",
        "status": "active",
        "next_billing_date": "2023-02-01T00:00:00Z"
      }
    }
  }
  ```

### ユーザープロフィール更新
- **エンドポイント**: `PATCH /users/profile`
- **リクエスト**:
  ```json
  {
    "name": "Updated Name",
    "email": "updated@example.com"
  }
  ```
- **レスポンス**:
  ```json
  {
    "status": "success",
    "data": {
      "id": "user_id",
      "email": "updated@example.com",
      "name": "Updated Name",
      "updated_at": "2023-01-15T00:00:00Z"
    }
  }
  ```

### パスワード変更
- **エンドポイント**: `POST /users/password`
- **リクエスト**:
  ```json
  {
    "current_password": "current_password",
    "new_password": "new_password"
  }
  ```
- **レスポンス**:
  ```json
  {
    "status": "success",
    "message": "パスワードが正常に変更されました"
  }
  ``` 